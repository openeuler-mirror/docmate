# 更新日志

## [1.4.0] - 2025-09-29

### 🚀 架构升级：LangChain框架重构

#### ✨ 核心架构改进

- **LangChain框架集成**：全面升级到LangChain框架，采用现代化的AI应用架构
- **LCEL表达式语言**：使用LangChain表达式语言构建声明式的AI处理流程
- **Map-Reduce处理模式**：实现基于Map-Reduce的复杂文本处理，支持长文档分块和并行计算
- **结构化输出**：使用Zod Schema确保返回数据的类型安全和一致性

#### 🔧 技术架构升级

- **LangChainService**：新增核心LangChain服务，统一管理AI交互
- **Chain模块化**：将AI功能拆分为独立的Chain模块（PolishChain、TranslateChain、RewriteChain、CheckChain）
- **FrontendAIService重构**：移除手写API调用代码，改为使用LangChain框架
- **类型安全增强**：通过Zod Schema提供强类型安全和自动验证

#### 🛠️ 用户体验优化

- **处理效率提升**：基于LangChain的优化处理流程，提供更高效的AI交互
- **错误处理统一**：统一的错误处理机制，提升系统稳定性
- **配置管理优化**：改进配置处理逻辑，支持用户配置与默认配置的智能回退
- **精确位置定位**：完善ValidationService的验证逻辑，增加精确位置映射

#### 📋 详细技术变更

- 新增 `LangChainService` 核心服务类
- 新增四个AI功能Chain模块，采用LCEL架构
- 重构 `FrontendAIService`，简化为LangChain的调用层
- 集成 `@langchain/core`、`@langchain/openai`、`zod` 依赖
- 优化 `ActionController` 中的配置处理逻辑
- 完善类型定义，增加精确位置支持

---

## [1.3.0] - 2025-09-22

### 🎉 重大更新：自定义检查规则功能

#### ✨ 核心新功能

- **自定义检查规则**：用户可以创建、编辑和管理自己的检查规则
- **规则管理界面**：直观的UI界面，支持规则的启用/禁用操作
- **动态规则注入**：运行时动态应用用户定义的检查标准
- **规则CRUD操作**：完整的创建、读取、更新、删除功能
- **规则验证机制**：确保规则内容的有效性和安全性

#### 🔧 技术架构改进

- **工具调用优化**：修复了自定义规则导致的工具调用失败问题
- **内容安全清理**：实现规则内容清理，防止特殊字符破坏JSON格式
- **缓存机制**：优化规则缓存，减少globalState访问次数
- **数据持久化**：通过VS Code globalState实现规则数据的可靠存储
- **接口扩展**：新增CheckRule相关TypeScript接口定义

#### 🛠️ 用户体验优化

- **灵活的检查控制**：用户可以根据需要启用/禁用特定检查规则
- **向后兼容**：保持原有功能的完整性，新增功能作为可选特性
- **默认规则集**：提供7种内置检查规则，涵盖常见文档检查需求
- **设置界面集成**：在侧边栏设置中新增"管理检查规则"入口

#### 🔍 代码质量提升

- **代码重构**：改进了代码结构，提升了可维护性
- **错误处理优化**：统一错误处理机制，提升系统稳定性
- **调试信息清理**：移除不必要的控制台日志，保持生产环境代码整洁
- **性能优化**：通过缓存和算法优化提升整体性能

#### 📋 详细技术变更

- 新增 `CheckRule`、`CheckRuleCommandPayload`、`CheckRuleCommandResult` 接口定义
- 在 `UserConfigService` 中实现检查规则的完整CRUD操作
- 新增 `CheckRuleManager` 前端UI组件
- 修改 `checkPrompts` 支持动态规则构建和内容安全清理
- 在 `ActionController` 中新增 `handleCheckRule` 方法
- 集成自定义规则到AI检查流程
- 实现规则内容的安全清理机制

---

## [1.2.0] - 2025-09-19

### 🚀 重大改进

#### 🔧 核心功能重构

- **智能分块处理**：实现基于Markdown结构感知的智能分块，提升长文档处理能力
- **并行处理优化**：AI调用并行化，大幅提升处理效率
- **精准文本替换**：使用成熟diff库替代手搓算法，实现真正的词级精度
- **VSCode集成增强**：优化快速替换功能，支持issues列表行号显示

#### 🛠️ 用户体验优化

- **智能建议清理**：点击接受/拒绝按钮后自动清除波浪线标记
- **文本处理改进**：重构分块服务文本清理逻辑，解决换行符和句末处理问题
- **重复文本修复**：解决suggestion重复文本定位和验证问题
- **代码质量提升**：完成代码清理和编译修复

#### 🔍 技术架构升级

- **分块服务重构**：实现更智能的Markdown结构感知分块算法
- **文本清理优化**：改进换行符和句末处理逻辑
- **错误处理完善**：增强suggestion定位和验证机制
- **性能优化**：通过并行处理和算法优化提升整体性能

---

## [1.1.0] - 2025-08-20

### 🚀 重大改进

#### 🔧 配置管理优化

- **智能配置保存**：移除自动保存功能，改为简洁的未保存更改提醒，避免意外保存
- **人性化配置指导**：重新设计配置项说明，解决推理模型 vs 普通模型的使用困境
- **配置建议面板**：新增可折叠的详细配置建议，包含模型对比、超时设置和使用场景指导
- **统一超时配置**：移除硬编码值，统一使用 UserConfigService 作为默认配置源
- **高级配置选项**：在配置界面添加超时时间、重试次数等高级配置选项
- **配置一致性**：移除 FrontendAIService 和 ActionController 中的硬编码超时值

#### 🛠️ 错误处理机制重构

- **智能错误分类**：实现基于优先级的错误分类系统，确保错误类型准确识别
- **完整错误信息显示**：修复错误消息只显示标准化友好消息的问题，现在显示具体错误详情
- **认证错误优先级**：优化 API 密钥等认证错误的识别，确保正确分类和显示
- **中英文错误支持**：增强中文错误信息提取能力，支持"无效的令牌"、"无可用渠道"等本地化错误
- **精确匹配算法**：使用边界匹配避免 request id 中数字被误认为 HTTP 状态码

#### 🎯 用户体验优化

- **配置界面改进**：简化配置保存流程，移除自动保存避免意外操作，只在有未保存更改时显示提醒
- **模型选择指导**：解决用户在推理模型（慢但准确）和普通模型（快但一般）之间的选择困扰
- **配置建议系统**：提供详细的模型推荐和超时设置指导，帮助用户根据使用场景做出最佳选择
- **重试次数正确显示**：修复加载状态中重试次数显示不准确的问题
- **优化加载提示**：LoadingSpinner 显示格式优化为 `操作名 • 运行时间 • 连接状态 • 重试信息`
- **Prompt 指令修复**：修复 AI 提示词误把指令当做原文的问题，提升 AI 处理准确性

### 🔍 技术改进

#### 错误处理架构

- 新增完整的错误处理工具集（15+ 个方法）
- 实现错误严重程度评估系统（critical/high/medium/low）
- 添加错误类型判断（网络错误、配置错误、用户错误）
- 完善 VS Code 集成的错误显示和日志记录

#### 配置管理架构

- 扩展 UserAIConfig 接口支持 timeout/maxRetries/testTimeout 配置
- 重构配置保存机制，移除自动保存功能，简化为手动保存+未保存提醒
- 新增配置建议组件，提供可折叠的详细配置指导界面
- 优化默认配置值，将默认模型改为快速模型，超时时间调整为 90 秒
- 统一配置源管理，提升配置一致性

---

## [1.0.0] - 2025-08-09

### 🎉 首次正式发布

DocMate 1.0.0 正式发布！专为 openEuler 文档编写设计的 VS Code 智能写作助手。

### ✨ 主要功能

- **🔍 智能文档检查**：语法检查、写作风格统一、内容一致性检查
- **✨ AI 文本润色**：基于 AI 的文本优化，提升表达清晰度和专业性
- **🌐 多语言翻译**：支持中英文互译，保持技术术语准确性
- **✏️ 智能重写**：根据需求重新组织内容，适应不同读者群体

### 🚀 用户体验

- **VS Code 深度集成**：侧边栏面板、右键菜单、命令面板支持
- **选择文本处理**：支持选中文本进行精确处理
- **实时结果显示**：在侧边栏实时显示处理结果和建议
- **一键应用**：支持一键应用 AI 建议到原文档

### 📋 支持文件类型

- Markdown 文件 (`.md`, `.markdown`)
- 纯文本文件 (`.txt`)
- 其他文本格式文件

### 🔮 后续开发计划

#### 即将推出

- 📚 **术语库管理**：内置 openEuler 专业术语库
- 📝 **文档模板**：标准化文档模板和格式规范
- 🎯 **实时检查**：输入时的实时语法检查
- 📊 **质量评分**：文档质量量化评估

#### 长期规划

- 🤖 **智能补全**：基于上下文的内容智能补全
- 🔗 **文档关联**：跨文档内容一致性检查
- 📈 **写作分析**：个人写作习惯分析
- 🌍 **多语言支持**：扩展更多语言支持

### 📞 反馈渠道

- 项目仓库：https://gitee.com/openeuler/docmate
- 问题反馈：https://gitee.com/openeuler/docmate/issues
